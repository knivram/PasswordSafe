generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String        @id
  email             String        @unique
  salt              String
  publicKey         String
  wrappedPrivateKey String
  vaultAccess       VaultAccess[]
}

model Vault {
  id          String        @id @default(uuid()) @db.Uuid
  name        String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  secrets     Secret[]
  vaultAccess VaultAccess[]
}

model Secret {
  id            String   @id @default(uuid()) @db.Uuid
  vaultId       String   @db.Uuid
  title         String
  encryptedData String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  isFavorite    Boolean  @default(false)
  vault         Vault    @relation(fields: [vaultId], references: [id], onDelete: Cascade)

  @@index([vaultId])
}

model VaultAccess {
  id         String     @id @default(uuid()) @db.Uuid
  vaultId    String     @db.Uuid
  userId     String
  role       AccessRole
  wrappedKey String
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  vault      Vault      @relation(fields: [vaultId], references: [id], onDelete: Cascade)

  @@unique([vaultId, userId])
  @@index([userId])
  @@index([vaultId])
}

enum AccessRole {
  OWNER
  EDITOR
  VIEWER
}
